<!DOCTYPE HTML>
<html>
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>MIET E-Lab Portal</title>
        <link rel="icon" href="logo.gif" type="image/png">
	<meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Nunito:200,300,400" rel="stylesheet">
	<link rel="stylesheet" href="css/animate.css">
	<link rel="stylesheet" href="css/icomoon.css">
        <script src="js/jquery.min.js"></script>
	<link rel="stylesheet" href="css/bootstrap.css">
        <script src="js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="css/magnific-popup.css">
	<link rel="stylesheet" href="css/owl.carousel.min.css">
	<link rel="stylesheet" href="css/owl.theme.default.min.css">
	<link rel="stylesheet" href="css/style.css">
        <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<script src="js/modernizr-2.6.2.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.4/ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="https://www.gstatic.com/firebasejs/6.1.0/firebase.js"></script>
	</head>
	<body style="background-color: black;">
              <nav class="navbar navbar-inverse" style="border-bottom: gray solid 2px;">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="console.html">Programming Console</a>
                    </div>
                    <div class="collapse navbar-collapse" id="myNavbar">
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <a href="javascript:void(0);"><strong id="user">User E-Mail</strong></a>
                            </li>
                            <li style="margin-right: 50px;">
                                <a href="javascript:void(0)" id="compile"><strong>Compile & Run</strong></a>
                            </li>
                            <li style="margin: 12px;">
                                <select id="language" onchange="changeMode()" style="margin-top: auto; margin-bottom: auto;">
                                    <option value="java">Java</option>
                                    <option value="c">C</option>
                                    <option value="c99">C-99</option>
                                    <option value="cpp">C++</option>
                                    <option value="cpp14">C++ 14</option>
                                    <option value="php">PHP</option>
                                    <option value="perl">Perl</option>
                                    <option value="python2">Python 2</option>
                                    <option value="python3">Python 3</option>
                                    <option value="ruby">Ruby</option>
                                    <option value="go">GoLang</option>
                                    <option value="scala">Scala</option>
                                    <option value="bash">Bash</option>
                                    <option value="sql">SQL</option>
                                    <option value="pascal">Pascal</option>
                                    <option value="csharp">C#</option>
                                    <option value="vbn">VB.Net</option>
                                    <option value="haskell">Haskell</option>
                                    <option value="objc">Objective C</option>
                                    <option value="swift">Swift</option>
                                    <option value="groovy">Groovy</option>
                                    <option value="fortran">FORTRAN</option>
                                    <option value="brainfuck">Brainfuck</option>
                                    <option value="lua">Lua</option>
                                    <option value="tcl">TCL</option>
                                    <option value="hack">Hack</option>
                                    <option value="rust">Rust</option>
                                    <option value="d">D</option>
                                    <option value="ada">Ada</option>
                                    <option value="r">R</option>
                                    <option value="freebasic">Free Basic</option>
                                    <option value="verilog">Verilog</option>
                                    <option value="cobol">COBOL</option>
                                    <option value="dart">Dart</option>
                                    <option value="yabasic">YaBasic</option>
                                    <option value="clojure">Clojure</option>
                                    <option value="nodejs">NodeJS</option>
                                    <option value="scheme">Scheme</option>
                                    <option value="forth">Forth</option>
                                    <option value="prolog">Prolog</option>
                                    <option value="octave">Octave</option>
                                    <option value="coffeescript">CoffeeScript</option>
                                    <option value="icon">Icon</option>
                                    <option value="fsharp">F#</option>
                                    <option value="nasm">NASM</option>
                                    <option value="gccasm">GCC</option>
                                    <option value="intercal">Intercal</option>
                                    <option value="nemerle">Nemerle</option>
                                    <option value="ocaml">Ocaml</option>
                                    <option value="unlambda">Unlambda</option>
                                    <option value="picolisp">Picolisp</option>
                                    <option value="spidermonkey">SpiderMonkey</option>
                                    <option value="rhino">Rhino JS</option>
                                    <option value="bc">BC</option>
                                    <option value="clisp">CLISP</option>
                                    <option value="elixir">Elixir</option>
                                    <option value="factor">Factor</option>
                                    <option value="falcon">Falcon</option>
                                    <option value="fantom">Fantom</option>
                                    <option value="nim">Nim</option>
                                    <option value="pike">Pike</option>
                                    <option value="smalltalk">SmallTalk</option>
                                    <option value="mozart">OZ Mozart</option>
                                    <option value="lolcode">LOLCODE</option>
                                    <option value="racket">Racket</option>
                                    <option value="kotlin">Kotlin</option>
                                    <option value="whitespace">Whitespace</option>
                                </select>
                            </li>
                        </ul>
                    </div>
                </div>
              </nav>
        <div id="editor" style="position: absolute; z-index: -1000; top:58px; right: 0;bottom: 0;left: 0;"></div>
        
        <div class="modal fade in" id="report" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">
                            <label>Final Report</label>
                        </div>
                    <div class="modal-body">
                        <p>You've scored <strong id='scorePer'></strong>. Your solution has been submitted successfully!</p>
                        <hr>
                        <span id='starArea' style='align-content: center;'>
                            
                        </span>
                    </div>
                        <div class='modal-footer'>
                            <a class="btn btn-success" href='javascript:void(0);' onclick="document.location.reload();">Proceed</a>
                        </div>
                </div>
            </div>
        </div>
        </div>
        
        <div class="modal fade in" id="wait" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class='modal-header'>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <div class='modal-title'>
                            <label>Working on it...&nbsp;</label><i class="fa fa-cog fa-spin fa-2x" aria-hidden="true" style="float:right;"></i>
                        </div>
                </div>
            </div>
        </div>
        </div>
        <div class="modal fade in" id="result" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <div class="modal-title">
                            <label>Output</label>
                        </div>
                    <div class="modal-body">
                        <pre id="stdOut"></pre>
                        <a href="javascript:void(0);" id="evaluate">Submit</a>
                    </div>
                </div>
                </div>
            </div>
        </div>
        <script>
            $('#compile').on('click',function()
            {
                $('#wait').modal('show');
                plag_check();
            });
            
            $('#evaluate').on('click',function()
            {
                $('#result').modal('hide');
                $('#wait').modal('show');
                evaluateFurther();
            });

            var editor, firebase,dataJ;
            const compiler_url = "https://api.jdoodle.com/v1/execute/";
            const proxy = "https://cors-anywhere.herokuapp.com/";
            const plag_url = "https://www.prepostseo.com/apis/checkPlag";
            var hiddenData = {
                input: 4,
                testCases:[
                    {
                        input:"1",
                        output:"0\n"
                    },
                    {
                        input:"2",
                        output:"0\n1\n"
                    },
                    {
                        input:"0",
                        output:""
                    }
                ]
            };
            
            $(document).ready(function()
            {
                initFirebase(setEnv);
            });
            function initFirebase(callback)
            {
                $.getJSON("firebase_config.json",function(conf)
                {
                    firebase.initializeApp(conf);
                    setTimeout(callback, 2000);
                });
            }
            function setEnv()
            {
                editor = ace.edit("editor");
                editor.setTheme("ace/theme/monokai");
                editor.session.setMode("ace/mode/java"); 
                $('#user').html(firebase.auth().currentUser.email);
            }
            function plag_check()
            {
                var src = editor.getValue();
                $.ajax({
                   url: plag_url,
                   method: "POST",
                   data:{key:"9bbe739a32b7df280930c8243a6ff707",data:src},
                   success: function(e)
                   {
                       e = JSON.parse(e);
                       if(e.plagPercent>=70)
                       {
                           alert("You seem to be have copied the source code from "+e.sources[0].link+". Contact adminstrator for more information.");
                       }
                       else
                       {
                           beforeSend(hiddenData.input,send,usage);
                       }
                   },
                   error: function(er)
                   {
                       $('#wait').modal('hide');
                       console.log(er);
                       alert('Having trouble while performing plagiarism check!');
                   }
                });
            }
            function usage(d)
            {
                $('#stdOut').html(d);
                $('#wait').modal('hide');
                $('#result').modal('show');
            }
            function send(callback)
            {
                $.ajax({
                    type: "POST",
                    url: proxy+compiler_url,
                    data: JSON.stringify(dataJ),
                    headers:{"Content-Type":"application/json"},
                    success: function(exec) {
                        callback(exec.output);
                    },
                    error: function(err) {
                        callback(err.message);
                    }
                });
            }
            function beforeSend(input,callback1,callback2) {
                var lang = $('#language').val();
                var src = editor.getValue();
                dataJ = {
                    "clientId": "86e3b4da0ce141c7c043d1dbb1e3b059",
                    "clientSecret": "74a51f4f738cd2d737d5d992b8d29233677617a6b732e10d4f8d781fbd72893",
                    "language": lang,
                    "script": src,
                    "versionIndex": "0",
                    "stdin":input
                };
                callback1(function(data)
                {
                    callback2(data);
                });
            }
            function changeMode()
            {
                let lang = $('#language').val();
                if(lang==="python2" || lang==="python3")
                {
                    editor.session.setMode("ace/mode/python");
                }
                else if(lang==="c" || lang==="cpp" || lang==="cpp14" || lang==="c99")
                {
                    editor.session.setMode("ace/mode/c_cpp");
                }
                else
                {
                    editor.session.setMode("ace/mode/"+lang);
                }
            }
            var x;
            var points;
            function comp(out)
            {
                let ans = hiddenData.testCases[x].output;
                if(ans===out)
                    points++;
                x++;
            }
            function evaluateFurther()
            {
                x = 0;
                points = 0;
                for (var i=0;i<hiddenData.testCases.length;i++)
                {
                    beforeSend(hiddenData.testCases[i].input,send,comp);
                }
                setTimeout(report, 2000);
            }
            function report()
            {
                $('#wait').hide();
                $('#result').hide();
                let score = Math.round(parseInt(points)/parseInt(hiddenData.testCases.length)*100);
                let starCount = 0;
                if(score>0 && score<=20)
                {
                    starCount = 1;
                }
                if(score>21 && score<=40)
                {
                    starCount = 2;
                }
                if(score>41 && score<=60)
                {
                    starCount = 3;
                }
                if(score>61 && score<=80)
                {
                    starCount = 4;
                }
                if(score>81 && score<=100)
                {
                    starCount = 5;
                }
                for(var i=0;i<starCount;i++)
                {
                    $('#starArea').append('<i class="fa fa-star" aria-hidden="true"></i>');
                }
                $('#scorePer').html(score+"%");
                $('#report').modal('show');
            }
        </script>
    </body>
</html>
