<!DOCTYPE HTML>
<html>
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>MIET E-Lab Portal</title>
        <link rel="icon" href="logo.gif" type="image/png">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Nunito:200,300,400" rel="stylesheet">
	<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/animate.css">
	<link rel="stylesheet" href="css/icomoon.css">
	<link rel="stylesheet" href="css/bootstrap.css">
	<link rel="stylesheet" href="css/magnific-popup.css">
	<link rel="stylesheet" href="css/owl.carousel.min.css">
	<link rel="stylesheet" href="css/owl.theme.default.min.css">
	<link rel="stylesheet" href="css/style.css">
	<script src="js/modernizr-2.6.2.min.js"></script>
	<script src="https://www.gstatic.com/firebasejs/6.1.0/firebase.js"></script>
	<script src="//www.google.com/recaptcha/api.js" async defer></script>
	<script src="js/jquery.min.js"></script>
	<script src="js/jquery.easing.1.3.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.waypoints.min.js"></script>
	<script src="js/jquery.stellar.min.js"></script>
	<script src="js/jquery.mb.YTPlayer.min.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/magnific-popup-options.js"></script>
	<script src="js/jquery.countTo.js"></script>
        <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
        <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
	<script src="js/main.js"></script>
        

	</head>
	<body>
		
	<div class="colorlib-loader"></div>

	<div id="page">
		<nav class="colorlib-nav" role="navigation">
			<div class="top-menu">
				<div class="container">
					<div class="row">
						<div class="col-md-2">
							<div id="colorlib-logo"><a href="index.html"><img src="logo.gif" style="width:4em; height:3em;" alt="MIET Meerut Logo"></a></div>
						</div>
						<div class="col-md-10 text-right menu-1">
							<ul>
								<li><a href="index.html">Home</a></li>
								<li><a href="labs.html">Browse Questions</a></li>
								<li class="active"><a href="login.html">Login / Sign Up</a></li>
								<li><a href="about.html">About</a></li>
								<li><a href="http://www.miet.ac.in/">College</a></li>
								<li><a href="contact.html">Contact</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</nav>

		<section id="home" class="video-hero" style="height: 500px; background-image: url(images/cover_img_1.jpg);  background-size:cover; background-position: center center;background-attachment:fixed;" data-section="home">
		<div class="overlay"></div>
			<div class="display-t display-t2 text-center">
				<div class="display-tc display-tc2">
					<div class="container">
						<div class="col-md-12 col-md-offset-0">
							<div class="animate-box">
								<h2>Login / Sign Up</h2>
								<p class="breadcrumbs"><span><a href="index.html">Home</a></span> <span>Login / Sign Up</span></p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>

		<div class="colorlib-services">
			<div class="container">
                                    <div class="panel">
                                        <div class="panel-heading bg-primary text-center">
                                            Login / Sign Up
                                        </div>
                                        <div class="panel-body form-group-lg">
                                            <input type="text" class="form-control" id="mail" placeholder="Enter E-Mail"/><hr>
                                            <input type="password" class="form-control" id="pass" placeholder="Enter Password"/>
                                        </div>
                                    </div>
                                <div>
                                    <label>Select your role / domain: &nbsp;</label><input type="checkbox" id="type" checked data-toggle="toggle" data-on="Student" data-off="Faculty">
                                    <div id="recaptcha" class='g-recaptcha' data-sitekey='6Lflm5kUAAAAAA1gU7tb_1sYavXDY4QaC1yn_3Mt' style='float:right;'></div>
                                    <br><br><br>
                                    <div id="loginBtn" onclick="MailSignIn();" class="btn btn-lg btn-primary" style="float:left;">Login</div>
                                    <div id="signupBtn" onclick="signUp();" class="btn btn-lg btn-primary" style="float:right;">Sign Up</div>
                                </div>
            </div>
        </div>
		<footer id="colorlib-footer">
				<div class="container">
					<div class="row">
						<div class="col-md-12 text-center">
							<p>
                                                            Copyright &copy; EDGE
                                                            <script> document.write(new Date().getFullYear());</script> All rights reserved<br>
                                                        <p style="font-size: 0.5em;">This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
                                                        </p>
						</div>
					</div>
                </div>
                <br><br>
		</footer>
	</div>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="icon-arrow-up2"></i></a>
	</div>
        <script>
            var firebase;
            $(document).ready(function(){
                $.getJSON("firebase_config.json",function(conf)
                {
                    firebase.initializeApp(conf);
                });
            });
            function MailSignIn()
            {
                $('#loginBtn').html('<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>');
                $('#loginBtn').addClass("disabled");
                var email = $('#mail').val();
                var password = $('#pass').val();
                var recaptcha = grecaptcha.getResponse();
                if(email && password && recaptcha)
                {
                    firebase.auth().signInWithEmailAndPassword(email, password).then(function()
                    {
                        if(firebase.auth().currentUser.emailVerified)
                        {
                            firebase.firestore().collection("type").doc(email).get().then(function(doc)
                            {
                                if (doc.exists) 
                                {
                                    if(doc.data().type==='student')
                                    {
                                        window.location.href = 'labs.html';
                                    }
                                    else
                                    {
                                        window.location.href = 'admin.html';
                                    }
                                } 
                                else 
                                {
                                    alert('Something went wrong, contact administrator');
                                    $('#loginBtn').html('Login');
                                    $('#loginBtn').removeClass("disabled");
                                    $('#mail').val("");
                                    $('#pass').val("");
                                    grecaptcha.reset();
                                }
                            }).catch(function(error) {
                                    alert(error.message);
                                    $('#loginBtn').html('Login');
                                    $('#loginBtn').removeClass("disabled");
                                    $('#mail').val("");
                                    $('#pass').val("");
                                    grecaptcha.reset();
                            });
                        }
                        else
                        {
                            alert("This account isn't verified yet, please verify to continue");
                            $('#loginBtn').html('Login');
                            $('#loginBtn').removeClass("disabled");
                            $('#mail').val("");
                            $('#pass').val("");
                            grecaptcha.reset();
                        }
                    }).catch(function(error) {
                        alert(error.message);
                        $('#loginBtn').html('Login');
                        $('#loginBtn').removeClass("disabled");
                        $('#mail').val("");
                        $('#pass').val("");
                        grecaptcha.reset();
                    });
                }
                else
                {
                    alert("Something missing, check all details carefully!");
                    $('#loginBtn').html('Login');
                    $('#loginBtn').removeClass("disabled");
                    $('#mail').val("");
                    $('#pass').val("");
                    grecaptcha.reset();
                }
            }
            function signUp()
            {
                $('#signupBtn').html('<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>');
                $('#signupBtn').addClass('disabled');
                var email = $('#mail').val();
                var pass = $('#pass').val();
                var type = 'student';
                if($('#type').val()==='on')
                {
                    type='student';
                }
                else
                {
                    type='faculty';
                }
                if(email && pass && grecaptcha.getResponse())
                {
                    firebase.auth().createUserWithEmailAndPassword(email, pass).then(function()
                    {
                        var user = firebase.auth().currentUser;
                        var db = firebase.firestore();
                        db.collection("type").doc(user.email).set({
                            email : email,
                            type : type
                        }).then(function(){
                            user.sendEmailVerification().then(function() 
                            {
                                alert('Verification link sent!');
                                grecaptcha.reset();
                                $('#mail').val("");
                                $('#pass').val("");
                                $('#signupBtn').html('Sign Up');
                                $('#signupBtn').removeClass('disabled');
                            }).catch(function(error) 
                            {
                                alert(error.message);
                                grecaptcha.reset();
                                $('#mail').val("");
                                $('#pass').val("");
                                $('#signupBtn').html('Sign Up');
                                $('#signupBtn').removeClass('disabled');
                            }); 
                        });
                    }).catch(function(error) 
                    {
                        alert(error.message);
                        grecaptcha.reset();
                        $('#mail').val("");
                        $('#pass').val("");
                        $('#signupBtn').html('Sign Up');
                        $('#signupBtn').removeClass('disabled');
                    });
                }
                else
                {
                    alert("Something missing, check all details carefully!");
                    grecaptcha.reset();
                    $('#mail').val("");
                    $('#pass').val("");
                    $('#signupBtn').html('Sign Up');
                    $('#signupBtn').removeClass('disabled');
                }
            }
            </script>
	</body>
</html>

